<a id="header"></a>
<!-- 
    Logo image generated by Bing IA: https://www.bing.com/images/create/
-->
<img src="./docs/assets/images/layout/header_title_challenge.png" alt="Med Planner Challenge">


<!-- 
    icons by:
    https://devicon.dev/
    https://simpleicons.org/
-->
[<img src="./docs/assets/images/icons/nodedotjs.svg" width="25px" height="25px" title="Node.js" alt="Node.js">](https://nodejs.org/en) [<img src="./docs/assets/images/icons/npm.svg" width="25px" height="25px" alt="npm" title="npm">](https://www.npmjs.com/) [<img src="./docs/assets/images/icons/eslint.svg" width="25px" height="25px" alt="Eslint" title="Eslint">](https://eslint.org/) [<img src="./docs/assets/images/icons/express.svg" width="25px" height="25px" title="Express" alt="Express">](https://expressjs.com/) [<img src="./docs/assets/images/icons/sequelize.svg" width="25px" height="25px" title="Sequelize" alt="Sequelize">](https://sequelize.com/) [<img src="./docs/assets/images/icons/jest.svg" width="25px" height="25px" alt="Jest" title="Jest">](https://jestjs.io/) [<img src="./docs/assets/images/icons/jsonwebtoken.svg" width="25px" height="25px" alt="JsonWebToken" title="JsonWebToken">](https://jwt.io/) [<img src="./docs/assets/images/icons/docker.svg" width="25px" height="25px" alt="Docker" title="Docker">](https://www.docker.com/) [<img src="./docs/assets/images/icons/github.svg" width="25px" height="25px" alt="GitHub" title="GitHub">](https://github.com/jtonynet) [<img src="./docs/assets/images/icons/visualstudiocode.svg" width="25px" height="25px" alt="vscode" title="vscode">](https://code.visualstudio.com/) [<img src="./docs/assets/images/icons/postman.svg" width="25px" height="25px" alt="Postman Logo" title="Postman">](https://www.postman.com/) [<img src="./docs/assets/images/icons/postgresql.svg" width="25px" height="25px" alt="PostgreSQL Logo" title="PostgreSQL">](https://www.postgresql.org/) [<img src="./docs/assets/images/icons/swagger.svg" width="25px" height="25px" alt="Swagger Logo" title="Swagger">](https://swagger.io/) [<img src="./docs/assets/images/icons/githubactions.svg" width="25px" height="25px" alt="GithubActions Logo" title="GithubActions">](https://docs.github.com/en/actions) [<img src="./docs/assets/images/icons/mermaidjs.svg" width="25px" height="25px" alt="MermaidJS Logo" title="MermaidJS">](https://mermaid.js.org/)

<!-- 
[<img src="./docs/assets/images/icons/dotenv.svg" width="25px" height="25px" alt="DotEnv Logo" title="DotEnv">](https://www.npmjs.com/package/dotenv)
[<img src="./docs/assets/images/icons/amazonaws.svg" width="25px" height="25px" alt="Amazon AWS Logo" title="Amazon AWS">](https://aws.amazon.com/pt/) [<img src="./docs/assets/images/icons/passport.svg" width="25px" height="25px" alt="Passport Logo" title="Passport">](https://www.passportjs.org/) [<img src="./docs/assets/images/icons/prometheus.svg" width="25px" height="25px" alt="Prometheus Logo" title="Prometheus">](https://prometheus.io/) [<img src="./docs/assets/images/icons/grafana.svg" width="25px" height="25px" alt="Grafana Logo" title="Grafana">](https://grafana.com/)
-->

[![Badge Status](https://img.shields.io/badge/STATUS-EM_DESENVOLVIMENTO-green)](#header) [![Github Project](https://img.shields.io/badge/PROJECT%20VIEW%20KANBAM-GITHUB-green?logo=github&logoColor=white)](https://github.com/users/jtonynet/projects/6) <!-- ![Badge GitHubActions](https://github.com/jtonynet/go-products-api/actions/workflows/main.yml/badge.svg?branch=main) -->

---

## ğŸ•¸ï¸ Redes

[![linkedin](https://img.shields.io/badge/Linkedin-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/jos%C3%A9-r-99896a39/) [![dev.to](https://img.shields.io/badge/dev.to-0A0A0A?style=for-the-badge&logo=devdotto&logoColor=white)](https://dev.to/learningenuity) [![gmail](https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:learningenuity@gmail.com)

---

## ğŸ“ O Projeto

<a id="index"></a>
### â¤´ï¸ Ãndice

__[Med Planner Challenge](#header)__<br/>
  1.  â¤´ï¸ [Ãndice](#index)
  2.  ğŸ“– [Sobre](#about)
  3.  ğŸ’» [Rodando o Projeto](#run)
  4.  ğŸ“° [DocumentaÃ§Ã£o da API](#api-docs)
  5.  ğŸ“Š [Diagramas](#diagrams)
  6.  âœ… [Testes](#tests)
  7.  ğŸ‘ [Boas PrÃ¡ticas](#best-practices)
  8.  ğŸ§  [ADR - Architecture Decision Records](#adr)
  9.  ğŸ”¢ [VersÃµes](#versions)
  10. ğŸ§° [Ferramentas](#tools)
  11. ğŸ¤– [Uso de AI](#ia)
  12. ğŸ [ConclusÃ£o](#conclusion)

---

<a id="about"></a>
### ğŸ“– Sobre

Acompanhe as tarefas pelo [__Kanban__](https://github.com/users/jtonynet/projects/6)

Este repositÃ³rio foi criado com a intenÃ§Ã£o de propor uma possÃ­vel soluÃ§Ã£o para o seguinte desafio:

> ğŸ‘¨â€ğŸ’» __Case Dev Backend:__
> 
> Construir o backend para um sistema de prontuÃ¡rio eletrÃ´nico onde o mÃ©dico pode
cadastrar as informaÃ§Ãµes do paciente como nome, telefone, data de nascimento, sexo,
altura e peso e fazer os registros das consultas realizadas por paciente.

> __1. Requisitos funcionais:__
> 
> - __Requisitos obrigatÃ³rios:__
>   - Eu, como mÃ©dico, quero poder cadastrar um paciente com os seguintes
dados: nome, telefone, email, data de nascimento, sexo, altura e peso.
>   - Eu, como mÃ©dico, quero poder listar e editar o perfil dos pacientes cadastrados.
>   - Eu, como mÃ©dico, quero poder cadastrar um agendamento de consulta para
um paciente.
>   - Eu, como mÃ©dico, quero poder listar, alterar e excluir os agendamentos de consulta.
>   - Eu, como mÃ©dico, quero poder anotar uma observaÃ§Ã£o durante a consulta.
>   - Eu, como mÃ©dico, quero poder visualizar as anotaÃ§Ãµes das consultas dos pacientes.
> 
> - __Requisitos desejÃ¡veis:__
>   - Eu como mÃ©dico, quero que o sistema valide a minha agenda, nÃ£o deixando
eu cadastrar mais de um paciente na mesma hora.
>   - Eu, como mÃ©dico, quero poder excluir os dados pessoais do paciente por causa
das novas regras do LGPD, mas mantendo o histÃ³rico de consulta por questÃµes de contabilidade
>
>
>
>  __2. Requisitos nÃ£o funcionais:__
> - __Requisitos obrigatÃ³rios__
>   - Deve usar o padrÃ£o de API REST (HTTP/JSON);
>   - Pode ser feito em __node.js__ (javascript ou typescript) ou PHP (laravel);
>   - DocumentaÃ§Ã£o da interface da API gerada (swagger, open-api, RAML ou postman);
>   - Os dados devem ser validados (existÃªncia e formatos) na inserÃ§Ã£o/atualizaÃ§Ã£o
para garantir consistÃªncia da base;
>   - Implementar testes unitÃ¡rios e/ou de integraÃ§Ã£o e/ou documentaÃ§Ã£o de testes
(casos de teste / script de teste).
>
> - __Requisitos desejÃ¡veis__
>   - DocumentaÃ§Ã£o da modelagem do banco de dados (diagrama ER ou de classe);
>   - Para o banco de dados pode usar MySQL ou PostgreSQL, podendo optar ou
nÃ£o pelo uso de ORM;
>   - Setup de ambiente de desenvolvimento usando docker / docker-compose;
>   - Hospedar em um ambiente cloud a sua escolha (Heroku, AWS EBS, IBM Cloud, etc);
>   - Garantir autenticaÃ§Ã£o e/ou autorizaÃ§Ã£o (login/logout, token JWT, roles);
>   - Implementar alguma ferramenta de lint ou qualidade (sonar, code-quality, eslint, etc);
>   - Deploy automatizado via pipeline (gitlab-ci, bitbucket pipeline, github actions, etc).


_*A documentaÃ§Ã£o original do desafio Ã© mais abrangente, com sugestÃµes de tela para o front e mais dados._

Faz sentido utilizar __Arquitetura de Duas Camadas__. Caso a complexidade aumente, podemos extender para o uso de uma terceira camada (`services/repository`).


[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="run"></a>
### ğŸ’» Rodando o Projeto

<a id="run-containerized"></a>
#### ğŸ‹ [QUEBRADO NO MOMENTO] Conteinerizado 

Rode os comandos `docker compose` (de acordo com sua versÃ£o do docker compose) no diretÃ³rio raiz do projeto:
```bash
/js-med-planner$ docker compose build
/js-med-planner$ docker compose up postgres-med-planner backend-rest
```

<!-- Acesse a rota: `http://localhost:8080/patients` -->

<br/>

<a id="run-locally"></a>
#### ğŸ  Local

API:
Com o node 20.17.0 instalado, suba apenas a base de dados com o comando:

```
/js-med-planner$ docker compose up postgres-med-planner
```
ou se conecte a uma database vÃ¡lida, entÃ£o vÃ¡ para o diretÃ³rio `backend-rest` e execute os comandos:

```bash
/js-med-planner/backend-rest$ npm install
/js-med-planner/backend-rest$ npm run dev
```
<br/>

#### â³ Migrations e seeds

No ambiente local e dentro da pasta `backend-rest`, rode o comando.

```bash
/js-med-planner/backend-rest$  npm run db:clean
```

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="api-docs"></a>
### ğŸ“°  DocumentaÃ§Ã£o da API

####  <img src="./docs/assets/images/icons/swagger.svg" width="20px" height="20px" alt="Swagger" title="Swagger">  Swagger

Com a aplicaÃ§Ã£o em execuÃ§Ã£o, a rota de documentaÃ§Ã£o Swagger fica disponÃ­vel em http://localhost:3000/docs/

O endpoint `/auth/login` provÃª um token `Bearer` que deve ser obtido e utilizado no `Authorize` do swagger para que as requisiÃ§Ãµes possam ser procedidas adequadamente.

O cliente deve informar o UUID do recurso para criaÃ§Ã£o. Para validaÃ§Ãµes, vocÃª pode utilizar um [site gerador de UUIDs](https://www.uuidgenerator.net/).

<img src="./docs/assets/images/screen_captures/swagger_medplanner_rest_api.png">

<br/>

####  <img src="./docs/assets/images/icons/postman.svg" width="20px" height="20px" alt="Swagger" title="Swagger">  Postman

Dentro da pasta [./scripts/postman](./scripts/postman/rjs-med-planner.postman_collection.json) encontra-se o arquivo JSON bÃ¡sico que pode ser importado no seu `Postman` para auxiliar em testes manuais e desenvolvimento.</summary>

<img src="./docs/assets/images/screen_captures/postman_medplanner_rest_api.png">

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="diagrams"></a>
### ğŸ“Š Diagramas do Sistema
_Diagramas Mermaid podem apresentar problemas de visualizaÃ§Ã£o em aplicativos mobile_

<!-- 
    diagrams by:
    https://mermaid.js.org/
-->

**ER:**

```mermaid
erDiagram 
    patient {
        int id
        UUID uuid
        string name
        string phone
        string email
        date birth_date
        enum gender
        decimal height
        decimal weight
    }
    appointment {
        int id
        UUID uuid
        int patient_id
        int doctor_id
        string description
        datetime start_time
        datetime end_time
    }
    doctor {
        int id
        UUID uuid
        string name
        string email
        string password
    }
    observation{
        int id
        UUID uuid
        int appointment_id
        string message
    }

    patient ||--o{ appointment : has
    doctor ||--o{ appointment : has
    appointment ||--o{ observation : has
```

   1. A abordagem da tabela `doctor` com o campo `password` foi aplicada apenas para ter uma autenticaÃ§Ã£o minima nos endpoints dos recursos desde o inicio. Caso alcance todos os requisitos obrigatÃ³rios do desafio e tenha tempo disponÃ­vel, pretendo implementar `user` com `roles` adequadas
<br/>

**Diagrama de Sistema:**

```mermaid
graph LR
    subgraph Doctor Flow
      DOCTOR(["ğŸ‘©â€âš•ï¸ Authorized Doctor"])

      DOCTOR --> CREATE_PATIENT("ğŸŒ Create Patient")
      DOCTOR --> RETRIEVE_PATIENT_LIST("ğŸŒ Retrieve Patient List")
      DOCTOR --> RETRIEVE_PATIENT("ğŸŒ Retrieve Patient")
      DOCTOR --> UPDATE_PATIENT("ğŸŒ Update Patient")
      DOCTOR --> DELETE_PATIENT("ğŸŒ Delete Patient")
    end

    subgraph Two Tier Architecture
      subgraph Controllers
        API_CREATE_PATIENT("ğŸ–¥ï¸ Create Patient")
        API_GET_PATIENTS("ğŸ–¥ï¸ Retrieve Patient")
        API_GET_PATIENT("ğŸ–¥ï¸ Get Patient by UUID")
        API_UPDATE_PATIENT("ğŸ–¥ï¸ Update Patient by UUID")
        API_DELETE_PATIENT("ğŸ–¥ï¸ Delete Patient by UUID")
      end

      subgraph Models
        ENTITY_PATIENT("ğŸ“„ Patient")
      end

      subgraph DATABASE
        MED_PLANNER_DB[("ğŸ—„ï¸ PostgreSQL <br/> med-planner-db")]
      end 
    end
  
  CREATE_PATIENT -->|http POST| API_CREATE_PATIENT
  RETRIEVE_PATIENT_LIST -->|http GET| API_GET_PATIENTS
  RETRIEVE_PATIENT -->|http GET| API_GET_PATIENT
  UPDATE_PATIENT -->|http PATCH| API_UPDATE_PATIENT
  DELETE_PATIENT -->|http DELETE| API_DELETE_PATIENT

  API_CREATE_PATIENT-->ENTITY_PATIENT
  API_GET_PATIENTS-->ENTITY_PATIENT
  API_GET_PATIENT-->ENTITY_PATIENT
  API_UPDATE_PATIENT-->ENTITY_PATIENT 
  API_DELETE_PATIENT-->ENTITY_PATIENT


  ENTITY_PATIENT-->MED_PLANNER_DB
```
_*Diagrama INICIAL geral com baixo nÃ­vel de fidelidade_


<br/>

<!-- 
    diagrams by:
    https://mermaid.js.org/
-->

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="tests"></a>
### âœ… Testes
_*TDD inicialmente com teste de integraÃ§Ã£o pois trata-se de um CRUD. Verificado sucesso do fluxo no "caminho feliz", implementarei os corner cases (validaÃ§Ãµes) com seus respectivos testes_

Com o projeto da backend-rest [adequadamente instalado](#run-locally) em seu ambiente local, levante o banco de testes com

```bash
/js-med-planner$ docker compose up test-postgres-med-planner
```

entÃ£o vÃ¡ para o diretÃ³rio do mesmo e execute o comando de testes:

```bash
/js-med-planner/backend-rest$ npm run test
```

<img src="./docs/assets/images/screen_captures/integration_tests_db.jpeg">

Cada vez que o comando for executado, a database de testes serÃ¡ recriada no test-postgres-med-planner assegurando uma execuÃ§Ã£o limpa

<img src="./docs/assets/images/screen_captures/integration_tests_run.jpeg">

SaÃ­da esperada pelo comando

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="best-practices"></a>
### ğŸ‘ Boas PrÃ¡ticas

- [Swagger](https://swagger.io/)
- [Github Project - Kanbam](https://github.com/users/jtonynet/projects/6)
- [Semantic Versioning 2.0.0](https://semver.org/spec/v2.0.0.html)
- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
- [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)
- [ADR - Architecture Decision Records](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)
- [Mermaid Diagrams](https://mermaid.js.org)
<!--
- [Observabilidade](https://en.wikipedia.org/wiki/Observability_(software)) com:
  - [Prometheus](.)
  - [Grafana](https://grafana.com/)
-->

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="adr"></a> 
### ğŸ§  ADR - Architecture Decision Records

- [0001: Registro de DecisÃµes de Arquitetura (ADR)](./docs/architecture/decisions/0001-registro-de-decisoes-de-arquitetura.md)
- [0002: Express, Sequelize e Postgres em API TDD Jest com arquitetura de Duas camadas](./docs/architecture/decisions/0002-express-sequelize-e-postgres-tdd-jest-com-arquitetura-de-api-em-duas-camadas.md)

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="versions"></a>
### ğŸ”¢ VersÃµes

As tags de versÃµes estÃ£o sendo criadas manualmente a medida que o projeto avanÃ§a com melhorias notÃ¡veis. Cada funcionalidade Ã© desenvolvida em uma branch a parte (Branch Based, [feature branch](https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow)) quando finalizadas Ã© gerada tag e mergeadas em master.

Para obter mais informaÃ§Ãµes, consulte o [HistÃ³rico de VersÃµes](./CHANGELOG.md).

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="tools"></a>
### ğŸ§° Ferramentas

- Linguagem:
  - [NodeJS v20.17.0](https://nodejs.org/en)
  - [NVM](https://github.com/nvm-sh/nvm)

- Framework & Libs:
  - [Express 4.21.0](https://expressjs.com/)
  - [Jest](https://jestjs.io/pt-BR/)
  - [Sequelize 6.37.3](https://sequelize.org/)
  - [.env](https://www.npmjs.com/package/dotenv)

- Infra & Technologias
  - [Docker v24.0.6](https://www.docker.com/)
  - [Docker compose v2.21.0](https://www.docker.com/)
  - [MySQL](https://www.postgresql.org/)
<!--
  - [Prometheus](https://prometheus.io/docs/guides/go-application)
  - [Grafana](https://grafana.com/)
-->

- GUIs:
  - [VsCode](https://code.visualstudio.com/)
  - [Postman](https://blog.postman.com/introducing-the-postman-vs-code-extension/)

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="ia"></a>
### ğŸ¤– Uso de AI

A figura do cabeÃ§alho nesta pÃ¡gina foi criada com a ajuda de inteligÃªncia artificial e um mÃ­nimo de retoques e construÃ§Ã£o no Gimp [<img src="./docs/assets/images/icons/gimp.svg" width="30" height="30 " title="Gimp" alt="Gimp Logo" />](https://www.gimp.org/)


__Os seguintes prompts foram usados para criaÃ§Ã£o no  [Bing IA:](https://www.bing.com/images/create/)__


<details>
  <summary><b>Jovem MÃ©dica</b></summary>
"medica mulher afrodescendente de Ã³culos segurando um Smartphone e olhando atentamente para ele com um leve sorriso. Fundo branco para fÃ¡cil remoÃ§Ã£o, estilo cartoon cores chapadas, historia em quadrinhos" <b>(sic)</b>
</details>

<br/>

__Arte e desenvolvimento sÃ£o, acima de tudo, atividades criativas humanas. Valorize as pessoas!__

Contrate artistas para projetos comerciais ou mais elaborados e aprenda a ser engenhoso!

[â¤´ï¸ de volta ao Ã­ndice](#index)

<br/>

---

<a id="conclusion"></a>
### ğŸ ConclusÃ£o

__TODO__

ğŸ˜ŠğŸš€

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<!-- 
Teste concorrendo com a app, derrubar porta 300
sudo kill -9 $(lsof -t -i:3000)

Criando Modelos com o cli do sequelize

```bash
sequelize model:create --name patients --attributes uuid:uuid,name:string,phone:string,email:string,birthDate:date,gender:string,height:float,weight:float
```

```bash
sequelize model:create --name doctors --attributes uuid:uuid,name:string,email:string,password:string
sequelize seed:create --name create-initial-doctor

sequelize model:create --name appointments --attributes uuid:uuid,patientId:int,doctorId:int,description:string,startTime:date,endTime:date

sequelize model:create --name observations --attributes uuid:uuid,appointmentId:int,message:string
```

//LIMPANDO DOCKER

docker stop $(docker ps -aq)
docker rm $(docker ps -aq)

docker rmi $(docker images -q) --force

docker volume rm $(docker volume ls -q) --force

docker network prune -f

docker system prune -a --volumes

sudo systemctl restart docker

-->


