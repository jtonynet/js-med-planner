<a id="header"></a>
<!-- 
    Logo image generated by Bing IA: https://www.bing.com/images/create/
-->
<img src="./docs/assets/images/layout/header_title_challenge.png" alt="Med Planner Challenge">


<!-- 
    icons by:
    https://devicon.dev/
    https://simpleicons.org/
-->
[<img src="./docs/assets/images/icons/nodedotjs.svg" width="25px" height="25px" title="Node.js" alt="Node.js">](https://nodejs.org/en) [<img src="./docs/assets/images/icons/npm.svg" width="25px" height="25px" alt="npm" title="npm">](https://www.npmjs.com/) [<img src="./docs/assets/images/icons/eslint.svg" width="25px" height="25px" alt="Eslint" title="Eslint">](https://eslint.org/) [<img src="./docs/assets/images/icons/express.svg" width="25px" height="25px" title="Express" alt="Express">](https://expressjs.com/) [<img src="./docs/assets/images/icons/sequelize.svg" width="25px" height="25px" title="Sequelize" alt="Sequelize">](https://sequelize.com/) [<img src="./docs/assets/images/icons/jest.svg" width="25px" height="25px" alt="Jest" title="Jest">](https://jestjs.io/) [<img src="./docs/assets/images/icons/jsonwebtoken.svg" width="25px" height="25px" alt="JsonWebToken" title="JsonWebToken">](https://jwt.io/) [<img src="./docs/assets/images/icons/docker.svg" width="25px" height="25px" alt="Docker" title="Docker">](https://www.docker.com/) [<img src="./docs/assets/images/icons/github.svg" width="25px" height="25px" alt="GitHub" title="GitHub">](https://github.com/jtonynet) [<img src="./docs/assets/images/icons/visualstudiocode.svg" width="25px" height="25px" alt="vscode" title="vscode">](https://code.visualstudio.com/) [<img src="./docs/assets/images/icons/postgresql.svg" width="25px" height="25px" alt="PostgreSQL Logo" title="PostgreSQL">](https://www.postgresql.org/) [<img src="./docs/assets/images/icons/swagger.svg" width="25px" height="25px" alt="Swagger Logo" title="Swagger">](https://swagger.io/) [<img src="./docs/assets/images/icons/githubactions.svg" width="25px" height="25px" alt="GithubActions Logo" title="GithubActions">](https://docs.github.com/en/actions) [<img src="./docs/assets/images/icons/mermaidjs.svg" width="25px" height="25px" alt="MermaidJS Logo" title="MermaidJS">](https://mermaid.js.org/)

<!-- 
[<img src="./docs/assets/images/icons/postman.svg" width="25px" height="25px" alt="Postman Logo" title="Postman">](https://www.postman.com/)
[<img src="./docs/assets/images/icons/dotenv.svg" width="25px" height="25px" alt="DotEnv Logo" title="DotEnv">](https://www.npmjs.com/package/dotenv)
[<img src="./docs/assets/images/icons/amazonaws.svg" width="25px" height="25px" alt="Amazon AWS Logo" title="Amazon AWS">](https://aws.amazon.com/pt/) [<img src="./docs/assets/images/icons/passport.svg" width="25px" height="25px" alt="Passport Logo" title="Passport">](https://www.passportjs.org/) [<img src="./docs/assets/images/icons/prometheus.svg" width="25px" height="25px" alt="Prometheus Logo" title="Prometheus">](https://prometheus.io/) [<img src="./docs/assets/images/icons/grafana.svg" width="25px" height="25px" alt="Grafana Logo" title="Grafana">](https://grafana.com/)
-->

[![Badge Status](https://img.shields.io/badge/STATUS-EM_DESENVOLVIMENTO-green)](#header) [![Github Project](https://img.shields.io/badge/PROJECT%20VIEW%20KANBAM-GITHUB-green?logo=github&logoColor=white)](https://github.com/users/jtonynet/projects/6)  ![Badge GitHubActions](https://github.com/jtonynet/js-med-planner/actions/workflows/main.yml/badge.svg?branch=main)

---

## üï∏Ô∏è Redes

[![linkedin](https://img.shields.io/badge/Linkedin-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/jos%C3%A9-r-99896a39/) [![dev.to](https://img.shields.io/badge/dev.to-0A0A0A?style=for-the-badge&logo=devdotto&logoColor=white)](https://dev.to/learningenuity) [![gmail](https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:learningenuity@gmail.com)

---

## üìÅ O Projeto

<a id="index"></a>
### ‚§¥Ô∏è √çndice

__[Med Planner Challenge](#header)__<br/>
  1.  ‚§¥Ô∏è [√çndice](#index)
  2.  üìñ [Sobre](#about)
  3.  üíª [Rodando o Projeto](#run)
  4.  üì∞ [Documenta√ß√£o da API](#api-docs)
  5.  üìä [Diagramas](#diagrams)
  6.  ‚úÖ [Testes](#tests)
  7.  üëè [Boas Pr√°ticas](#best-practices)
  8.  üß† [ADR - Architecture Decision Records](#adr)
  9.  üî¢ [Vers√µes](#versions)
  10. üß∞ [Ferramentas](#tools)
  11. ü§ñ [Uso de AI](#ia)
  12. üèÅ [Conclus√£o](#conclusion)

---

<a id="about"></a>
### üìñ Sobre

Acompanhe as tarefas pelo [__Kanban__](https://github.com/users/jtonynet/projects/6)

Este reposit√≥rio foi criado com a inten√ß√£o de propor uma poss√≠vel solu√ß√£o para o seguinte desafio:

> üë®‚Äçüíª __Case Dev Backend:__
> 
> Construir o backend para um sistema de prontu√°rio eletr√¥nico onde o m√©dico pode
cadastrar as informa√ß√µes do paciente como nome, telefone, data de nascimento, sexo,
altura e peso e fazer os registros das consultas realizadas por paciente.

> __1. Requisitos funcionais:__
> 
> - __Requisitos obrigat√≥rios:__
>   - Eu, como m√©dico, quero poder cadastrar um paciente com os seguintes
dados: nome, telefone, email, data de nascimento, sexo, altura e peso.
>   - Eu, como m√©dico, quero poder listar e editar o perfil dos pacientes cadastrados.
>   - Eu, como m√©dico, quero poder cadastrar um agendamento de consulta para
um paciente.
>   - Eu, como m√©dico, quero poder listar, alterar e excluir os agendamentos de consulta.
>   - Eu, como m√©dico, quero poder anotar uma observa√ß√£o durante a consulta.
>   - Eu, como m√©dico, quero poder visualizar as anota√ß√µes das consultas dos pacientes.
> 
> - __Requisitos desej√°veis:__
>   - Eu como m√©dico, quero que o sistema valide a minha agenda, n√£o deixando
eu cadastrar mais de um paciente na mesma hora.
>   - Eu, como m√©dico, quero poder excluir os dados pessoais do paciente por causa
das novas regras do LGPD, mas mantendo o hist√≥rico de consulta por quest√µes de contabilidade
>
>
>
>  __2. Requisitos n√£o funcionais:__
> - __Requisitos obrigat√≥rios__
>   - Deve usar o padr√£o de API REST (HTTP/JSON);
>   - Pode ser feito em __node.js__ (javascript ou typescript) ou PHP (laravel);
>   - Documenta√ß√£o da interface da API gerada (swagger, open-api, RAML ou postman);
>   - Os dados devem ser validados (exist√™ncia e formatos) na inser√ß√£o/atualiza√ß√£o
para garantir consist√™ncia da base;
>   - Implementar testes unit√°rios e/ou de integra√ß√£o e/ou documenta√ß√£o de testes
(casos de teste / script de teste).
>
> - __Requisitos desej√°veis__
>   - Documenta√ß√£o da modelagem do banco de dados (diagrama ER ou de classe);
>   - Para o banco de dados pode usar MySQL ou PostgreSQL, podendo optar ou
n√£o pelo uso de ORM;
>   - Setup de ambiente de desenvolvimento usando docker / docker-compose;
>   - Hospedar em um ambiente cloud a sua escolha (Heroku, AWS EBS, IBM Cloud, etc);
>   - Garantir autentica√ß√£o e/ou autoriza√ß√£o (login/logout, token JWT, roles);
>   - Implementar alguma ferramenta de lint ou qualidade (sonar, code-quality, eslint, etc);
>   - Deploy automatizado via pipeline (gitlab-ci, bitbucket pipeline, github actions, etc).


_*A documenta√ß√£o original do desafio √© mais abrangente, com sugest√µes de tela para o front e mais dados._

Faz sentido utilizar __Arquitetura de Duas Camadas__. Caso a complexidade aumente, podemos extender para o uso de uma terceira camada (`services/repository`).


[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="run"></a>
### üíª Rodando o Projeto

<a id="environment"></a>
#### üåê Ambiente
Docker e Docker Compose s√£o necess√°rios para rodar a aplica√ß√£o de forma containerizada, e √© fortemente recomendado utiliz√°-los para rodar o banco de dados localmente.

Crie uma copia do arquivo `./backend-rest/.env.SAMPLE` e renomeie para `./backend-rest/.env`.

<br/>

<a id="run-containerized"></a>
#### üêã Conteinerizado 

Com a `.env` editada, rode os comandos `docker compose` (de acordo com sua vers√£o do docker compose) no diret√≥rio raiz do projeto:
```bash
/js-med-planner$ docker compose build
/js-med-planner$ docker compose up postgres-med-planner -d
/js-med-planner$ docker compose up backend-rest
```
Caso seja a primeira vez que o projeto esteja sendo iniciado, ser√° necess√°rio rodar as migrations do banco de dados. O seguinte comando pode ser utilizado sempre que for necess√°rio criar ou resetar o banco de dados de desenvolvimento local:
```bash
/js-med-planner$ docker compose exec backend-rest npm run db:clean
```
Ap√≥s a base ser (re)constru√≠da, a API esta pronta e a rota da [documenta√ß√£o swagger](#api-docs) estar√° dispon√≠vel, assim como a [suite de testes](#tests) poder√° ser executada.

<!-- 
  docker compose exec backend-rest npm run db:clean

  /js-med-planner$ docker compose up postgres-med-planner backend-rest 
  /js-med-planner$ docker compose up postgres-med-planner test-postgres-med-planner 
-->

<br/>

<a id="run-locally"></a>
#### üè† Local

Com o Node 20.17.0 instalado e ap√≥s seguir os comandos de edi√ß√£o do arquivo `./backend-rest/.env`, ser√£o necess√°rias outras altera√ß√µes para que a aplica√ß√£o funcione corretamente no seu localhost. Observe que h√° linhas com coment√°rios semelhantes ao seguinte:
```bash
# local: 127.0.0.1 || conteinerized: postgres-med-planner
```
Substitua os valores das `envs` com esses comentarios para o valor sugerido na primeira opcao `local`
```bash
DB_HOST=127.0.0.1 # local: 127.0.0.1 || conteinerized: postgres-med-planner
```

Ap√≥s editar o arquivo, suba apenas o banco de dados com o comando:

```
/js-med-planner$ docker compose up postgres-med-planner
```
ou se conecte a uma database v√°lida, ent√£o v√° para o diret√≥rio `backend-rest` e execute os comandos:

```bash
/js-med-planner/backend-rest$ npm install
/js-med-planner/backend-rest$ npm run dev
```
Use `npm run db:clean` para (re)construir o DB de desenvolvimento se necessario
<br/>


<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="api-docs"></a>
### üì∞  Documenta√ß√£o da API

####  <img src="./docs/assets/images/icons/swagger.svg" width="20px" height="20px" alt="Swagger" title="Swagger">  Swagger

Com a aplica√ß√£o em execu√ß√£o, a rota de documenta√ß√£o Swagger fica dispon√≠vel em http://localhost:3000/docs/

O endpoint `/auth/login` prov√™ um token `Bearer` que deve ser obtido e utilizado no `Authorize` do swagger para que as requisi√ß√µes possam ser procedidas adequadamente.

O cliente deve informar o UUID do recurso para cria√ß√£o. Para valida√ß√µes, voc√™ pode utilizar um [site gerador de UUIDs](https://www.uuidgenerator.net/).

<img src="./docs/assets/images/screen_captures/swagger_medplanner_rest_api.png">

<br/>

<!-- 
####  <img src="./docs/assets/images/icons/postman.svg" width="20px" height="20px" alt="Swagger" title="Swagger">  Postman

Dentro da pasta [./scripts/postman](./scripts/postman/rjs-med-planner.postman_collection.json) encontra-se o arquivo JSON b√°sico que pode ser importado no seu `Postman` para auxiliar em testes manuais e desenvolvimento.</summary>

<img src="./docs/assets/images/screen_captures/postman_medplanner_rest_api.png">
-->

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="diagrams"></a>
### üìä Diagramas do Sistema
_Diagramas Mermaid podem apresentar problemas de visualiza√ß√£o em aplicativos mobile_

<!-- 
    diagrams by:
    https://mermaid.js.org/
-->

**ER:**

```mermaid
erDiagram 
    patient {
        int id
        UUID uuid
        string name
        string phone
        string email
        date birthDate
        enum gender
        decimal height
        decimal weight
        datetime createdAt
        datetime updatedAt
        datetime deletedAt
    }
    appointment {
        int id
        UUID uuid
        int patientId
        int doctorId
        string description
        string observation
        datetime startTime
        datetime endTime
        datetime createdAt
        datetime updatedAt
        datetime deletedAt
    }
    doctor {
        int id
        UUID uuid
        string name
        string email
        string password
        datetime createdAt
        datetime updatedAt
        datetime deletedAt
    }

    patient ||--o{ appointment : has
    doctor ||--o{ appointment : has
```

   1. A abordagem da tabela `doctor` com o campo `password` foi aplicada apenas para ter uma autentica√ß√£o minima nos endpoints dos recursos desde o inicio. Caso alcance todos os requisitos obrigat√≥rios do desafio e tenha tempo dispon√≠vel, pretendo implementar `user` com `roles` adequadas e uma pol√≠tica de `refresh-token`
<br/>

<br/>

<!-- 
    diagrams by:
    https://mermaid.js.org/
-->

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="tests"></a>
### ‚úÖ Testes

Com o projeto da backend-rest [adequadamente instalado](#run) em seu ambiente local ou conteinerizado, levante o banco de testes com

```bash
/js-med-planner$ docker compose up test-postgres-med-planner -d
```

e execute o comando:
```bash
/js-med-planner$ docker compose exec backend-rest npm run test
```
ou ent√£o v√° para o diret√≥rio da API e execute o comando de testes:

```bash
/js-med-planner/backend-rest$ npm run test
```

Cada vez que o comando for executado, a database de testes ser√° recriada no test-postgres-med-planner assegurando uma execu√ß√£o limpa.
Sa√≠da esperada pelo comando:
<img src="./docs/assets/images/screen_captures/integration_tests_run.jpeg">

Os testes tamb√©m s√£o executados como parte da rotina minima de __CI__ do <a href="https://github.com/jtonynet/go-products-api/actions">GitHub Actions</a>, garantindo que vers√µes est√°veis sejam mescladas na branch principal. O badge __TESTS_CI__ no [cabe√ßalho](#header) do arquivo readme √© uma ajuda visual para verificar rapidamente a integridade do desenvolvimento.
<img src="./docs/assets/images/screen_captures/githubactions_medplanner_test.png">

Essa abordagem deve evoluir para uma rotina adequada de __CD__ no futuro.

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="best-practices"></a>
### üëè Boas Pr√°ticas

- [Swagger](https://swagger.io/)
- [Github Project - Kanbam](https://github.com/users/jtonynet/projects/6)
- [Semantic Versioning 2.0.0](https://semver.org/spec/v2.0.0.html)
- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
- [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)
- [ADR - Architecture Decision Records](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)
- [Mermaid Diagrams](https://mermaid.js.org)
<!--
- [Observabilidade](https://en.wikipedia.org/wiki/Observability_(software)) com:
  - [Prometheus](.)
  - [Grafana](https://grafana.com/)
-->

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="adr"></a> 
### üß† ADR - Architecture Decision Records

- [0001: Registro de Decis√µes de Arquitetura (ADR)](./docs/architecture/decisions/0001-registro-de-decisoes-de-arquitetura.md)
- [0002: Express, Sequelize e Postgres em API TDD Jest com arquitetura de Duas camadas](./docs/architecture/decisions/0002-express-sequelize-e-postgres-tdd-jest-com-arquitetura-de-api-em-duas-camadas.md)

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="versions"></a>
### üî¢ Vers√µes

As tags de vers√µes est√£o sendo criadas manualmente a medida que o projeto avan√ßa com melhorias not√°veis. Cada funcionalidade √© desenvolvida em uma branch a parte (Branch Based, [feature branch](https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow)) quando finalizadas √© gerada tag e mergeadas em master.

Para obter mais informa√ß√µes, consulte o [Hist√≥rico de Vers√µes](./CHANGELOG.md).

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="tools"></a>
### üß∞ Ferramentas

- Linguagem:
  - [NodeJS v20.17.0](https://nodejs.org/en)
  - [NVM](https://github.com/nvm-sh/nvm)

- Framework & Libs:
  - [Express 4.21.0](https://expressjs.com/)
  - [Jest](https://jestjs.io/pt-BR/)
  - [Sequelize 6.37.3](https://sequelize.org/)

- Infra & Technologias
  - [Docker v24.0.6](https://www.docker.com/)
  - [Docker compose v2.21.0](https://www.docker.com/)
  - [MySQL](https://www.postgresql.org/)

- GUIs:
  - [VsCode](https://code.visualstudio.com/)

  <!--
  - [Postman](https://blog.postman.com/introducing-the-postman-vs-code-extension/)
  --> 

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<a id="ia"></a>
### ü§ñ Uso de AI

A figura do cabe√ßalho nesta p√°gina foi criada com a ajuda de intelig√™ncia artificial e um m√≠nimo de retoques e constru√ß√£o no Gimp [<img src="./docs/assets/images/icons/gimp.svg" width="30" height="30 " title="Gimp" alt="Gimp Logo" />](https://www.gimp.org/)


__Os seguintes prompts foram usados para cria√ß√£o no  [Bing IA:](https://www.bing.com/images/create/)__


<details>
  <summary><b>Jovem M√©dica</b></summary>
"medica mulher afrodescendente de √≥culos segurando um Smartphone e olhando atentamente para ele com um leve sorriso. Fundo branco para f√°cil remo√ß√£o, estilo cartoon cores chapadas, historia em quadrinhos" <b>(sic)</b>
</details>

<br/>

__Arte e desenvolvimento s√£o, acima de tudo, atividades criativas humanas. Valorize as pessoas!__

Contrate artistas para projetos comerciais ou mais elaborados e aprenda a ser engenhoso!

[‚§¥Ô∏è de volta ao √≠ndice](#index)

<br/>

---

<a id="conclusion"></a>
### üèÅ Conclus√£o

Mantive o desenvolvimento focado em atingir os requisitos obrigat√≥rios, com testes de integra√ß√£o e valida√ß√µes, em uma estrutura simples de duas camadas, pois o problema n√£o parecia exigir mais do que isso, embora a aus√™ncia de testes unitarios seja sentida.

Validar o conflito de hor√°rios de agendamento me pareceu o ponto central da API. Adotei, por padr√£o, o timezone America/Sao_Paulo para evitar conflitos (facilitando o desenvolvimento). Uma solu√ß√£o mais robusta pode ser implementada caso seja necess√°rio lidar com diferentes fusos hor√°rios.

Deletar os dados do paciente, adotei soft delete (paranoid) e criptografia simples por simplicidade e tempo. A abordagem correta √© utilizar uma estrat√©gia de Crypto-Shredding, que "remove" tamb√©m dos backups.

Embora exista uma branch com o rascunho inicial do front-end que consumiria a API, resolvi focar esfor√ßos na pr√≥pria API, buscando ader√™ncia √† posi√ß√£o e aos demais desafios propostos, visando produtividade.

Os testes de integra√ß√£o est√£o rodando conforme o CI. N√£o tive tempo h√°bil para criar e me aprofundar em uma esteira de CD, mas esse √© um tema que me interessa.

Desde o in√≠cio, preocupei-me com uma autentica√ß√£o m√≠nima para permitir que o projeto evolu√≠sse sem a necessidade de grandes refactors quando recursos mais avan√ßados, como roles e refresh tokens, fossem necess√°rios.

Essas s√£o minhas considera√ß√µes sobre o que consegui produzir ao longo desse desafio, e continuarei me aplicando aos pontos cegos que n√£o tive tempo ou conhecimento para aprimorar.



üòäüöÄ

<br/>

[‚§¥Ô∏è de volta ao √≠ndice](#index)

---

<!-- 
Teste concorrendo com a app, derrubar porta 300
sudo kill -9 $(lsof -t -i:3000)

Criando Modelos com o cli do sequelize

```bash
sequelize model:create --name patients --attributes uuid:uuid,name:string,phone:string,email:string,birthDate:date,gender:string,height:float,weight:float
```

```bash
sequelize model:create --name doctors --attributes uuid:uuid,name:string,email:string,password:string
sequelize seed:create --name create-initial-doctor

sequelize model:create --name appointments --attributes uuid:uuid,patientId:int,doctorId:int,description:string,startTime:date,endTime:date

sequelize model:create --name observations --attributes uuid:uuid,appointmentId:int,message:string
```

//LIMPANDO DOCKER

docker stop $(docker ps -aq)
docker rm $(docker ps -aq)

docker rmi $(docker images -q) --force

docker volume rm $(docker volume ls -q) --force

docker network prune -f

docker system prune -a --volumes

sudo systemctl restart docker

-->


